var app=angular.module("Currency",["ngAnimate"]);app.controller("currenciesCtrl",["$scope","$http",function($scope,$http){try{$scope.currencies=JSON.parse(localStorage.currencies)}catch(e){$scope.currencies=["XBT"]}try{$scope.from=JSON.parse(localStorage.from)}catch(e){$scope.from={value:1,currency:"XBT"}}$http.get("http://aqueous-temple-6169.herokuapp.com/api/v1/currencies").success(function(data){$scope.currenciesList=data}),$scope.$watch("from",function(newValues){localStorage.from=JSON.stringify(newValues)},!0),$scope.$watch("currencies",function(newValues){localStorage.currencies=JSON.stringify(newValues)},!0),$scope.addCurrency=function(currency){$scope.isSelected(currency)?$scope.currencies.splice($scope.currencies.indexOf(currency),1):$scope.currencies.push(currency)},$scope.isSelected=function(currency){return-1!==$scope.currencies.indexOf(currency)},$scope.hideAside=function(){$scope.aside=!1},$scope.toggleAside=function(event){event.stopPropagation(),$scope.aside=!$scope.aside,$scope.aside&&($scope.nextCurrency="")}}]),app.directive("currency",["$http",function($http){return{replace:!0,scope:{toCurrency:"@",from:"="},templateUrl:"views/components/currency.html",link:function(scope){scope.changeBaseOnKeyUp=function(event){(event.keyCode>=48&&event.keyCode<=57||event.keyCode>=96&&event.keyCode<=105||8===event.keyCode||46===event.keyCode)&&scope.changeBase()},scope.changeBase=function(){scope.from.value=+scope.toValue,scope.from.currency=scope.toCurrency},scope.$watch("from",function(newValue,oldValue){scope.from.currency===scope.toCurrency?scope.toValue=scope.from.value:scope.exchange&&newValue.currency===oldValue.currency?scope.toValue=+(scope.from.value*scope.exchange.rate):$http.get("http://aqueous-temple-6169.herokuapp.com/api/v1/rate/"+scope.from.currency+"/"+scope.toCurrency).success(function(rate){scope.exchange=rate,scope.toValue=+(scope.from.value*scope.exchange.rate)})},!0)}}}]),app.directive("format",["$filter",function($filter){return{require:"ngModel",link:function(scope,element,attrs,controller){element.bind("blur",function(){this.value=$filter("currency")(this.value.replace(/,/g,""),"")}),controller.$formatters.push(function(value){return $filter("currency")(value,"")}),controller.$parsers.push(function(value){var val=(""+value).replace(/,/g,"");return+val})}}}]),app.directive("forceFocus",["$timeout",function($timeout){return{link:function(scope,element,attrs){scope.$watch(attrs.forceFocus,function(value){value!==!1&&$timeout(function(){element[0].focus()},0)})}}}]),app.directive("selectAll",function(){return{link:function(scope,element){element.on("click",function(){this.select()})}}}),app.filter("highlight",["$sce",function($sce){return function(text,phrase){return phrase&&(text=text.replace(new RegExp("("+phrase+")","gi"),'<span class="highlighted">$1</span>')),$sce.trustAsHtml(text)}}]);